<!DOCTYPE html>
<html lang="en">
<head>
    <title>Order & Payment</title>

    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        body {
            font-family: Arial;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1;
            margin: 40px;
        }

        table {
            margin-top: 20px;
        }

        td {
            padding: 8px;
        }

        input, select {
            padding: 6px;
        }

        button {
            padding: 10px 20px;
            margin-top: 15px;
        }

        .result {
            font-weight: bold;
            margin-top: 20px;
        }

        .success { color: green; }
        .error { color: red; }

        /* Card validation icons */
        #cardIcon {
            font-size: 18px;
            margin-left: 8px;
            font-weight: bold;
        }

        .valid-check {
            color: green;
        }

        .invalid-check {
            color: red;
        }

        footer {
            background-color: #2e7d32;
            color: white;
            text-align: center;
            padding: 15px;
            font-weight: bold;
        }

        footer a {
            color: white;
            text-decoration: none;
        }
    </style>
</head>

<body>

<div class="content">

<h1>E-Commerce Order and Payment</h1>

<h2>Order Information</h2>
<p><strong>Order ID:</strong> <span id="orderId"></span></p>

<table>
    <tr>
        <td><label>First Name</label></td>
        <td><input type="text" id="firstName" required></td>
    </tr>

    <tr>
        <td><label>Last Name</label></td>
        <td><input type="text" id="lastName" required></td>
    </tr>

    <tr>
        <td><label>Address</label></td>
        <td><input type="text" id="address" size="40" required></td>
    </tr>
</table>

<h2>Card Details</h2>

<table>

    <tr>
        <td><label>Card Type</label></td>
        <td>
            <select id="cardType" required>
                <option value="">Select Card Type</option>
                <option value="visa">Visa</option>
                <option value="mastercard">MasterCard</option>
                <option value="amex">American Express</option>
                <option value="discover">Discover</option>
            </select>
        </td>
    </tr>

    <tr>
        <td><label>Name on Card</label></td>
        <td><input type="text" id="cardName" size="30" maxlength="50"></td>
    </tr>

    <!-- UPDATED CARD NUMBER FIELD -->
    <tr>
        <td><label>Card Number</label></td>
        <td>
            <input type="text"
                   id="cardNumber"
                   maxlength="16"
                   placeholder="16-digit card number"
                   oninput="validateCardNumber(this)">
            <span id="cardIcon"></span>
        </td>
    </tr>

    <tr>
        <td><label>Expiration Date (MM/YY)</label></td>
        <td>
            <input type="text" id="expiryDate" maxlength="5"
                   placeholder="MM/YY"
                   oninput="formatExpiry(this)">
        </td>
    </tr>

    <tr>
        <td><label>CVV</label></td>
        <td>
            <input type="password" id="cvv"
                   maxlength="4"
                   pattern="[0-9]{3,4}">
        </td>
    </tr>

    <tr>
        <td><label>Billing Zip Code</label></td>
        <td>
            <input type="text"
                   id="zipcode"
                   maxlength="5"
                   placeholder="5-digit ZIP">
        </td>
    </tr>

    <tr>
        <td><label>Payment Amount ($)</label></td>
        <td>
            <input type="number"
                   id="amount"
                   step="0.01"
                   min="0.01">
        </td>
    </tr>

    <tr>
        <td colspan="2">
            <button onclick="submitPayment()">Submit Payment</button>
        </td>
    </tr>

</table>

<div id="result" class="result"></div>

</div>

<footer>
    <p>Team 10 | Integration With Payment Provider & Handle Ecommerce Payment Flows</p>
</footer>

<script>

// Generate Order ID
function generateOrderId() {
    return "ORD" + Math.floor(Math.random() * 1000000);
}

document.getElementById("orderId").innerText = generateOrderId();

// Expiry format MM/YY
function formatExpiry(input) {
    let value = input.value.replace(/\D/g, '');
    if (value.length >= 3) {
        input.value = value.substring(0,2) + "/" + value.substring(2,4);
    } else {
        input.value = value;
    }
}

// Card Number Validation
function validateCardNumber(input) {

    // Remove non-numeric characters
    input.value = input.value.replace(/\D/g, '');

    const icon = document.getElementById("cardIcon");

    if(input.value.length === 16) {
        icon.innerHTML = "✔";
        icon.className = "valid-check";
        return true;
    } else {
        icon.innerHTML = "✖";
        icon.className = "invalid-check";
        return false;
    }
}

// Expiration Validation
function validateExpiration() {
    const expiry = document.getElementById("expiryDate").value;
    const parts = expiry.split("/");

    if(parts.length !== 2) return false;

    const month = parseInt(parts[0]);
    const year = parseInt("20" + parts[1]);

    const today = new Date();
    const expDate = new Date(year, month);

    return expDate > today;
}

// ZIP Code Validation
function validateZip() {
    const zip = document.getElementById("zipcode").value;
    return /^[0-9]{5}$/.test(zip);
}

// Payment Simulation
function submitPayment() {

    const result = document.getElementById("result");
    const cardValid = validateCardNumber(document.getElementById("cardNumber"));

    if(!cardValid) {
        result.innerHTML = "Invalid card number.";
        result.className = "result error";
        return;
    }

    if(!validateExpiration()) {
        result.innerHTML = "Card is expired.";
        result.className = "result error";
        return;
    }

    if(!validateZip()) {
        result.innerHTML = "Invalid ZIP Code.";
        result.className = "result error";
        return;
    }

    const random = Math.random();

    if(random <= 0.60) {
        result.innerHTML = "Payment Approved ✔";
        result.className = "result success";
    }
    else if(random <= 0.77) {
        result.innerHTML = "Invalid Card Details ✖";
        result.className = "result error";
    }
    else if(random <= 0.94) {
        result.innerHTML = "Insufficient Funds ✖";
        result.className = "result error";
    }
    else {
        result.innerHTML = "500 Internal Server Error ✖";
        result.className = "result error";
    }
}

</script>

</body>
</html>
